# Миграция на JWT токены

## Что изменилось?

Система аутентификации была обновлена с серверных сессий на JWT токены. Это решает проблему выхода пользователей из аккаунта при передеплое сервера на Render.com.

## Основные изменения:

### 1. Сервер (server/index.js)
- ✅ Удалена зависимость от `express-session`
- ✅ Добавлена библиотека `jsonwebtoken`
- ✅ Passport настроен без сессий (`session: false`)
- ✅ При успешной аутентификации генерируется JWT токен (срок действия: 30 дней)
- ✅ Токен передается клиенту вместе с данными пользователя

### 2. Клиент (src/utils/database.ts)
- ✅ Данные пользователя и токен сохраняются в `localStorage`
- ✅ При перезагрузке страницы пользователь остается авторизованным
- ✅ Токен автоматически извлекается и используется для API запросов

### 3. Переменные окружения (.env)
- ✅ Добавлена переменная `JWT_SECRET` для подписи токенов

## Преимущества:

1. **Устойчивость к передеплою** - пользователи не выходят из аккаунта при перезапуске сервера
2. **Масштабируемость** - токены не требуют хранения на сервере
3. **Безопасность** - токены подписаны и имеют срок действия
4. **Удобство** - пользователи остаются авторизованными даже после закрытия браузера

## Что нужно сделать:

1. Установить зависимости:
   ```bash
   npm install
   ```

2. Убедиться, что в `.env` файле есть `JWT_SECRET`:
   ```
   JWT_SECRET=KOTAKBAS3991-JWT-SECRET-KEY-2024
   ```

3. Передеплоить на Render.com:
   - Render автоматически подхватит изменения из Git
   - Или используйте Manual Deploy в панели Render

4. Добавить `JWT_SECRET` в Environment Variables на Render.com:
   - Перейдите в настройки вашего сервиса на Render
   - Добавьте переменную `JWT_SECRET` со значением из `.env`

## Обратная совместимость:

Существующие пользователи должны будут войти заново один раз после обновления. После этого они останутся авторизованными даже при передеплое.

## Резервная копия:

Старая версия сервера сохранена в `server/index.backup.js` на случай необходимости отката.
